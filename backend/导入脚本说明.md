# 🎬 电影数据导入脚本使用说明

## 📝 概述

`import-movie.js` 是一个专门用于将 JSON 电影数据文件导入到数据库的命令行工具。

## 🚀 使用方法

### 基本用法

```bash
# 使用默认设置导入 (电影名称: "凤起长街", 文件: resources/dataNew.json)
node import-movie.js

# 指定电影名称
node import-movie.js "我的电影"

# 指定电影名称和文件路径
node import-movie.js "我的电影" "resources/my-movie.json"
```

## ✨ 功能特点

### 1. 自动读取 JSON 文件
- 自动解析 JSON 格式
- 显示文件内容统计信息

### 2. 智能检查
- 检查电影是否已存在于数据库
- 如果存在则自动更新数据

### 3. 验证导入
- 导入后自动验证数据完整性
- 显示节点数量、角色数量等信息

### 4. 友好的输出
- 彩色终端输出
- 详细的步骤提示
- 清晰的成功/失败状态

## 📊 输出示例

```
📽️  准备导入电影: 凤起长街
📁 数据文件: resources/dataNew.json

========================================
   🎬 电影数据导入工具
========================================

📋 步骤 1/4: 读取JSON文件
📂 正在读取文件: c:\...\backend\resources\dataNew.json
✅ 文件读取成功
   - 节点数量: 8
   - 角色数量: 0
   - 视口设置: {"x":0,"y":0,"zoom":1}

🔍 步骤 2/4: 检查数据库
✅ 数据库中不存在此电影,可以创建

💾 步骤 3/4: 导入数据到数据库
✅ 数据导入成功!
   数据库ID: 8
   电影名称: 凤起长街

✅ 步骤 4/4: 验证导入结果
✅ 验证通过!
   - 节点数量: 8
   - 角色数量: 0
   - 创建时间: 2026/1/13 11:04:27
   - 更新时间: 2026/1/13 11:04:27

========================================
   🎉 导入完成!
========================================

💡 提示:
   查看API: http://localhost:3002/api/movies/name/凤起长街
   查看列表: http://localhost:3002/api/movies
```

## 🎯 使用场景

### 场景 1: 首次导入电影数据

```bash
node import-movie.js
```

### 场景 2: 导入多个不同的电影

```bash
# 导入第一部电影
node import-movie.js "凤起长街" "resources/dataNew.json"

# 导入第二部电影
node import-movie.js "宫廷秘史" "resources/movie2.json"

# 导入第三部电影
node import-movie.js "武侠传奇" "resources/movie3.json"
```

### 场景 3: 更新现有电影数据

如果电影已存在于数据库,脚本会自动更新数据:

```bash
node import-movie.js "凤起长街" "resources/dataNew-updated.json"
```

## 📁 JSON 文件格式

导入的 JSON 文件应遵循以下格式:

```json
{
  "nodes": {
    "node_001": {
      "id": "node_001",
      "title": "节点标题",
      "content": "节点内容",
      "options": [...]
    }
  },
  "characters": {},
  "viewport": {
    "x": 0,
    "y": 0,
    "zoom": 1
  }
}
```

## 🔗 相关 API

导入后,您可以使用以下 API 访问数据:

### 获取所有电影列表
```bash
curl http://localhost:3002/api/movies
```

### 根据名称获取电影数据
```bash
curl http://localhost:3002/api/movies/name/凤起长街
```

### 根据ID获取电影数据
```bash
curl http://localhost:3002/api/movies/1
```

## ⚠️ 注意事项

1. **数据库连接**: 确保服务器正在运行且数据库连接正常
2. **文件路径**: 文件路径相对于项目根目录
3. **数据格式**: 确保 JSON 文件格式正确
4. **名称唯一性**: 电影名称在数据库中必须唯一

## 🛠️ 故障排查

### 问题: 文件未找到
```
❌ 读取文件失败: ENOENT: no such file or directory
```

**解决**: 检查文件路径是否正确,确保文件存在

### 问题: JSON 解析失败
```
❌ 读取文件失败: Unexpected token...
```

**解决**: 检查 JSON 文件格式是否正确

### 问题: 数据库连接失败
```
❌ 导入过程中发生错误: connect ECONNREFUSED
```

**解决**:
1. 检查 MySQL 服务是否运行
2. 检查 `.env` 配置是否正确
3. 确认数据库已创建

## 📦 与其他工具的关系

- **import-movie.js**: 命令行导入工具 (本脚本)
- **test-api.js**: API 功能测试工具
- **API 接口**: RESTful API 接口

## 💡 最佳实践

1. **备份数据**: 导入前备份重要数据
2. **测试数据**: 先用测试数据验证流程
3. **验证导入**: 导入后使用 API 验证数据完整性
4. **文档记录**: 记录每次导入的电影名称和文件

## 🎉 总结

`import-movie.js` 是一个简单易用的数据导入工具,可以帮助您快速将 JSON 格式的电影数据导入到数据库中。配合 API 接口,可以实现完整的数据管理工作流。
